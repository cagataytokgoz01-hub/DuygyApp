<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ModÃ¼l 6</title>

<style>
html, body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  touch-action:manipulation;
}

body{
  margin:0;
  width:100vw;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(#b7e2ff,#e9f7ff);
  overflow:hidden;
}

/* â¬œ ORTA ALAN */
.stage{
  width:96vw;
  max-width:1200px;
  height:90vh;
  max-height:520px;
  background:#ffffff;
  border-radius:24px;
  position:relative;
  overflow:hidden;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}

/* SAYFALAR */
.page{
  position:absolute;
  inset:0;
  display:none;
}
.page.active{ display:block; }

/* 1. SAYFA */
.start-btn{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#22c55e;
  border:none;
  cursor:pointer;
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  box-shadow:0 8px 22px rgba(0,0,0,.25);
}

/* ðŸ¦˜ KANGURU */
.kangaroo-frame{
  position:absolute;
  right:16px;
  bottom:16px;
  width:120px;
  height:120px;
  background:#ffffff;
  border-radius:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
.kangaroo-frame img{
  width:90%;
  pointer-events:none;
}

/* 2. SAYFA â€“ DUYGULAR (AYNEN KALDI) */
.emotions{
  width:100%;
  height:100%;
  padding:24px 140px 24px 24px;
  box-sizing:border-box;
  display:grid;
  grid-template-columns:repeat(3, minmax(0, 1fr));
  gap:32px;
  place-items:center;
  place-content:center;
}

.emotion-card{
  width:100%;
  max-width:130px;
  aspect-ratio:1 / 1;
  box-sizing:border-box;
  border-radius:18px;
  border:3px solid transparent;
  display:flex;
  align-items:center;
  justify-content:center;
}
.emotion-card.selected{
  border-color:#22c55e;
  transform:scale(1.04);
}
.emotion-card img{
  width:82%;
  height:82%;
  object-fit:contain;
}

/* YEÅžÄ°L BUTON */
.next-btn{
  position:absolute;
  right:16px;
  bottom:16px;
  width:90px;
  height:90px;
  border-radius:50%;
  background:#22c55e;
  border:none;
  cursor:pointer;
}

/* YATAY */
.rotate-overlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:#ffffff;
  z-index:999999;
}
@media (orientation: portrait){
  .rotate-overlay{ display:flex; }
  .stage{ display:none; }
}
@media (orientation: landscape){
  .rotate-overlay{ display:none; }
  .stage{ display:block; }
}

#backBtn{
  position:fixed;
  top:12px;
  left:12px;
  width:44px;
  height:44px;
  background:transparent;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000000;
  text-decoration:none;
}

#backBtn img{
  width:44px;
  height:44px;
  display:block;
  pointer-events:none;
}

/* =========================
   3. SAYFA ORTALAMA
========================= */

.page3-wrap{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}

.page3-emotions{
  display:flex;
  gap:40px;
  align-items:center;
  justify-content:center;
}

.page3-emotions img{
  width:min(160px, 22vw);
  max-width:160px;
  border-radius:18px;
}

.rotate-overlay img{
  max-width:90vw;
  max-height:90vh;
  object-fit:contain;
}

.choice-wrap{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:80px;
}

.choice-btn{
  background:none;
  border:none;
  cursor:pointer;
}

.choice-btn img{
  width:140px;
  max-width:20vw;
}

.audio-wrap{
  width:100%;
  height:100%;
  position:relative;
}

/* ORTA MÄ°KROFON */
.audio-btn.center{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%);
  background:none;
  border:none;
  cursor:pointer;
}
.audio-btn.center img{
  width:200px;
}

/* SOL â€“ Ä°NDÄ°R */
.audio-btn.left{
  position:absolute;
  left:24px;
  bottom:24px;
  background:none;
  border:none;
  cursor:pointer;
}
.audio-btn.left img{
  width:44px;
  opacity:.4;
}
.audio-btn.left.active img{
  opacity:1;
}

/* SAÄž â€“ KAPAT */
.audio-btn.right{
  position:absolute;
  right:24px;
  bottom:24px;
  background:none;
  border:none;
  cursor:pointer;
}
.audio-btn.right img{
  width:44px;
}

</style>
</head>

<body>

<div class="rotate-overlay">
  <img src="images/yatay.png" alt="EkranÄ± yatay Ã§evir">
</div>

<div class="stage">
<a id="backBtn" href="../index.html" aria-label="Geri">
  <img src="images/geri.png" alt="Geri">
</a>

<!-- 1. SAYFA -->
<div class="page active" id="page1">
  <button class="start-btn" onclick="goNext()"></button>
  <div class="kangaroo-frame">
    <img src="images/gif_kanguru.gif">
  </div>
</div>

<!-- 2. SAYFA -->
<div class="page" id="page2">
  <div class="emotions">
    <div class="emotion-card" data-name="heyecanlÄ±" data-src="images/2_heyecanli.png"><img src="images/2_heyecanli.png"></div>
<div class="emotion-card" data-name="kÄ±zgÄ±n"    data-src="images/2_kizmis.png"><img src="images/2_kizmis.png"></div>
<div class="emotion-card" data-name="korkmuÅŸ"   data-src="images/2_korkmus.png"><img src="images/2_korkmus.png"></div>
<div class="emotion-card" data-name="neÅŸeli"    data-src="images/2_neseli.png"><img src="images/2_neseli.png"></div>
<div class="emotion-card" data-name="sakin"     data-src="images/2_sakin.png"><img src="images/2_sakin.png"></div>
<div class="emotion-card" data-name="Ã¼zgÃ¼n"     data-src="images/2_uzgun.png"><img src="images/2_uzgun.png"></div>
  </div>
  <button class="next-btn" onclick="goPage3()"></button>
</div>

<!-- 3. SAYFA -->
<div class="page" id="page3">
  <div class="page3-wrap">
    <div class="page3-emotions" id="page3Emotions"></div>
  </div>
  <button class="next-btn" onclick="goPage4()"></button>
</div>

<!-- 4. SAYFA -->
<div class="page" id="page4">
  <div class="choice-wrap">

    <button class="choice-btn" onclick="goChoice('audio')">
      <img src="images/4_ses_kaydi.png" alt="Ses KaydÄ±">
    </button>

    <button class="choice-btn" onclick="goChoice('draw')">
      <img src="images/4_resim.png" alt="Resim Yap">
    </button>

    <button class="choice-btn" onclick="goChoice('skip')">
      <img src="images/4_gec.png" alt="GeÃ§">
    </button>
    </div>
</div>

<!-- 4A â€“ SES KAYDI -->
<div class="page" id="page_audio">
  <div class="audio-wrap">

    <!-- Mavi Ä°ndir -->
    <button id="downloadBtn" class="audio-btn left" disabled>
      <img src="images/s_indir.png">
    </button>

    <!-- Mikrofon -->
    <button id="recordBtn" class="audio-btn center">
      <img id="micIcon" src="images/s_mic1.png">
    </button>

    <!-- KÄ±rmÄ±zÄ± Kapat -->
    <button id="closeBtn" class="audio-btn right">
      <img src="images/s_kapat.png">
    </button>
  </div>
</div>

<div class="page" id="page_draw"></div>
<div class="page" id="page_skip"></div>

<script>
const page1 = document.getElementById("page1");
const page2 = document.getElementById("page2");
const pageBlank = document.getElementById("page_blank");

/* SAYFA GEÃ‡Ä°ÅžLERÄ° */
function goNext(){
  page1.classList.remove("active");
  page2.classList.add("active");
}
function goBlank(){
  page2.classList.remove("active");
  pageBlank.classList.add("active");
}

/* DUYGU SEÃ‡Ä°MÄ° â€“ EN FAZLA 3 (AYNEN KALDI) */
const selected = [];
const selectedSrc = [];

document.querySelectorAll(".emotion-card").forEach(card=>{
  card.onclick = ()=>{
    const src = card.dataset.src;

    if(card.classList.contains("selected")){
      card.classList.remove("selected");

      const i = selectedSrc.indexOf(src);
      if(i > -1){
        selected.splice(i,1);
        selectedSrc.splice(i,1);
      }

    }else{
      if(selectedSrc.length >= 3) return;

      card.classList.add("selected");
      selected.push(card.dataset.name);
      selectedSrc.push(src);
    }
  };
});

const page3 = document.getElementById("page3");
const page3Emotions = document.getElementById("page3Emotions");

function goPage3(){
  page2.classList.remove("active");
  page3.classList.add("active");

  renderSelectedEmotionsOnPage3();
}

function renderSelectedEmotionsOnPage3(){
  page3Emotions.innerHTML = "";

  selectedSrc.forEach(src=>{
    const img = document.createElement("img");
    img.src = src;              // âœ… DOÄžRU YOL
    page3Emotions.appendChild(img);
  });
}

const page4 = document.getElementById("page4");

function goPage4(){
  page3.classList.remove("active");
  page4.classList.add("active");
}

function goChoice(type){
  page4.classList.remove("active");
  document.getElementById("page_" + type).classList.add("active");
}

let mediaRecorder;
let audioChunks = [];
let audioBlob;
let audioUrl;
let isRecording = false;

const recordBtn = document.getElementById("recordBtn");
const micIcon  = document.getElementById("micIcon");
const downloadBtn = document.getElementById("downloadBtn");
const closeBtn = document.getElementById("closeBtn");

/* ðŸŽ¤ MÄ°KROFON */
recordBtn.onclick = async ()=>{
  if(!isRecording){
    const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];

    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

    mediaRecorder.onstop = ()=>{
      audioBlob = new Blob(audioChunks, { type:"audio/webm" });
      audioUrl = URL.createObjectURL(audioBlob);

      downloadBtn.disabled = false;
      downloadBtn.classList.add("active");
    };

    mediaRecorder.start();
    isRecording = true;

    micIcon.src = "images/s_mic2.png"; // ðŸ”´ kÄ±rmÄ±zÄ±
  }else{
    mediaRecorder.stop();
    isRecording = false;

    micIcon.src = "images/s_mic1.png"; // âš« siyah
  }
};

/* â¬‡ï¸ Ä°NDÄ°R */
downloadBtn.onclick = ()=>{
  if(!audioUrl) return;

  const a = document.createElement("a");
  a.href = audioUrl;
  a.download = "ses-kaydi.webm";
  a.click();
};

/* âŒ KAPAT â€“ RESET */
closeBtn.onclick = ()=>{
  location.reload(); // 1. sayfaya sÄ±fÄ±rdan dÃ¶ner
};

</script>

</body>
</html>
